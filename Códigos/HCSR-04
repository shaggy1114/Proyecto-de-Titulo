/*
  Código para Arduino Mega 2560
  Mide la distancia con un sensor HC-SR04 y enciende un LED
  si la distancia es menor a 15 cm.

  Hardware:
  - Arduino Mega 2560
  - Sensor HC-SR04
  - LED Rojo
  
  Conexiones:
  - Pin 29 (Mega) -> Pin Trig (HC-SR04)
  - Pin 31 (Mega) -> Pin Echo (HC-SR04)
  - Pin 33 (Mega) -> Resistencia (ej. 220 ohm) -> Ánodo (+) del LED
  - GND (Mega)    -> Cátodo (-) del LED
  - 5V (Mega)     -> Pin VCC (HC-SR04)
  - GND (Mega)    -> Pin GND (HC-SR04)
*/

// --- Definición de Pines ---
const int trigPin = 29;
const int echoPin = 31;
const int ledPin = 33;

// --- Constantes ---
const int umbralDistancia = 15; // Distancia en cm para encender el LED

// --- Variables Globales ---
long duracion; // Tiempo que tarda el eco en volver
int distancia; // Distancia calculada en cm

void setup() {
  // Configurar los pines
  pinMode(trigPin, OUTPUT); // Trig es un pin de salida
  pinMode(echoPin, INPUT);  // Echo es un pin de entrada
  pinMode(ledPin, OUTPUT);  // El LED es una salida
  
  // Iniciar el monitor serial para depuración (opcional)
  Serial.begin(9600);
  Serial.println("Sensor HC-SR04 y LED listos.");
}

void loop() {
  // --- Paso 1: Generar el pulso del Trigger ---
  // Aseguramos que el trigPin esté bajo primero
  digitalWrite(trigPin, LOW);
  delayMicroseconds(2);
  
  // Enviamos el pulso ultrasónico (10 microsegundos)
  digitalWrite(trigPin, HIGH);
  delayMicroseconds(10);
  digitalWrite(trigPin, LOW);
  
  // --- Paso 2: Leer el tiempo del Echo ---
  // La función pulseIn() mide el tiempo (en microsegundos)
  // que el pin de echo tarda en pasar de BAJO a ALTO y volver a BAJO.
  duracion = pulseIn(echoPin, HIGH);
  
  // --- Paso 3: Calcular la distancia en cm ---
  // Velocidad del sonido = 343 m/s = 0.0343 cm/µs
  // El sonido viaja de ida y vuelta, así que dividimos por 2.
  // Fórmula: distancia = (duracion * 0.0343) / 2
  // O simplificado: distancia = duracion / 58.3
  distancia = duracion * 0.01715;

  // --- Paso 4: Controlar el LED basado en la lógica ---
  if (distancia < umbralDistancia && distancia > 0) {
    // Si el objeto está más cerca que el umbral (y la lectura es válida)
    digitalWrite(ledPin, HIGH); // Encender el LED
  } else {
    // Si está más lejos o la lectura es 0 (fuera de rango)
    digitalWrite(ledPin, LOW); // Apagar el LED
  }
  
  // --- (Opcional) Imprimir la distancia en el Monitor Serial ---
  Serial.print("Distancia: ");
  Serial.print(distancia);
  Serial.println(" cm");
  
  // Pequeña pausa antes de la siguiente medición
  delay(100); 
}
